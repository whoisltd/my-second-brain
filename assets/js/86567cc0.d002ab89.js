"use strict";(self.webpackChunkmy_second_brain=self.webpackChunkmy_second_brain||[]).push([[9467],{3905:(t,n,a)=>{a.d(n,{Zo:()=>p,kt:()=>s});var e=a(7294);function r(t,n,a){return n in t?Object.defineProperty(t,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[n]=a,t}function c(t,n){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var e=Object.getOwnPropertySymbols(t);n&&(e=e.filter((function(n){return Object.getOwnPropertyDescriptor(t,n).enumerable}))),a.push.apply(a,e)}return a}function i(t){for(var n=1;n<arguments.length;n++){var a=null!=arguments[n]?arguments[n]:{};n%2?c(Object(a),!0).forEach((function(n){r(t,n,a[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):c(Object(a)).forEach((function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(a,n))}))}return t}function l(t,n){if(null==t)return{};var a,e,r=function(t,n){if(null==t)return{};var a,e,r={},c=Object.keys(t);for(e=0;e<c.length;e++)a=c[e],n.indexOf(a)>=0||(r[a]=t[a]);return r}(t,n);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(t);for(e=0;e<c.length;e++)a=c[e],n.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(t,a)&&(r[a]=t[a])}return r}var o=e.createContext({}),h=function(t){var n=e.useContext(o),a=n;return t&&(a="function"==typeof t?t(n):i(i({},n),t)),a},p=function(t){var n=h(t.components);return e.createElement(o.Provider,{value:n},t.children)},u="mdxType",m={inlineCode:"code",wrapper:function(t){var n=t.children;return e.createElement(e.Fragment,{},n)}},g=e.forwardRef((function(t,n){var a=t.components,r=t.mdxType,c=t.originalType,o=t.parentName,p=l(t,["components","mdxType","originalType","parentName"]),u=h(a),g=r,s=u["".concat(o,".").concat(g)]||u[g]||m[g]||c;return a?e.createElement(s,i(i({ref:n},p),{},{components:a})):e.createElement(s,i({ref:n},p))}));function s(t,n){var a=arguments,r=n&&n.mdxType;if("string"==typeof t||r){var c=a.length,i=new Array(c);i[0]=g;var l={};for(var o in n)hasOwnProperty.call(n,o)&&(l[o]=n[o]);l.originalType=t,l[u]="string"==typeof t?t:r,i[1]=l;for(var h=2;h<c;h++)i[h]=a[h];return e.createElement.apply(null,i)}return e.createElement.apply(null,a)}g.displayName="MDXCreateElement"},3512:(t,n,a)=>{a.r(n),a.d(n,{assets:()=>o,contentTitle:()=>i,default:()=>u,frontMatter:()=>c,metadata:()=>l,toc:()=>h});var e=a(7462),r=(a(7294),a(3905));const c={slug:"what i know a bout spark",title:"Spark",authors:["whoisltd"],tags:["spark","apache-spark","programming","big-data"],sidebar_position:1},i="What i know about Spark",l={unversionedId:"big-data/spark",id:"big-data/spark",title:"Spark",description:"Spark l\xe0 g\xec?",source:"@site/docs/big-data/spark.md",sourceDirName:"big-data",slug:"/big-data/what i know a bout spark",permalink:"/docs/big-data/what i know a bout spark",draft:!1,editUrl:"https://github.com/whoisltd/my-second-brain/blob/main/docs/big-data/spark.md",tags:[{label:"spark",permalink:"/docs/tags/spark"},{label:"apache-spark",permalink:"/docs/tags/apache-spark"},{label:"programming",permalink:"/docs/tags/programming"},{label:"big-data",permalink:"/docs/tags/big-data"}],version:"current",sidebarPosition:1,frontMatter:{slug:"what i know a bout spark",title:"Spark",authors:["whoisltd"],tags:["spark","apache-spark","programming","big-data"],sidebar_position:1},sidebar:"tutorialSidebar",previous:{title:"Big Data",permalink:"/docs/category/big-data"},next:{title:"English",permalink:"/docs/category/english"}},o={},h=[{value:"Spark l\xe0 g\xec?",id:"spark-l\xe0-g\xec",level:2},{value:"\u0110i\u1ec3m n\u1ed5i b\u1eadt",id:"\u0111i\u1ec3m-n\u1ed5i-b\u1eadt",level:2},{value:"PySpark",id:"pyspark",level:2},{value:"Create a SparkSession",id:"create-a-sparksession",level:3},{value:"Create the DataFrame",id:"create-the-dataframe",level:3},{value:"Exploratory Data Analysis",id:"exploratory-data-analysis",level:3},{value:"Data Pre-processing",id:"data-pre-processing",level:3},{value:"G\xe1n recency score cho m\u1ed7i kh\xe1ch h\xe0ng",id:"g\xe1n-recency-score-cho-m\u1ed7i-kh\xe1ch-h\xe0ng",level:4},{value:"Ch\u1ecdn giao d\u1ecbch mua g\u1ea7n \u0111\xe2y nh\u1ea5t",id:"ch\u1ecdn-giao-d\u1ecbch-mua-g\u1ea7n-\u0111\xe2y-nh\u1ea5t",level:5},{value:"Frequency",id:"frequency",level:4},{value:"Monetary Value",id:"monetary-value",level:4},{value:"T\xecm t\u1ed5ng s\u1ed1 ti\u1ec1n chi ti\xeau trong m\u1ed7i l\u1ea7n mua h\xe0ng:",id:"t\xecm-t\u1ed5ng-s\u1ed1-ti\u1ec1n-chi-ti\xeau-trong-m\u1ed7i-l\u1ea7n-mua-h\xe0ng",level:5},{value:"T\xecm t\u1ed5ng s\u1ed1 ti\u1ec1n chi ti\xeau c\u1ee7a m\u1ed7i kh\xe1ch h\xe0ng:",id:"t\xecm-t\u1ed5ng-s\u1ed1-ti\u1ec1n-chi-ti\xeau-c\u1ee7a-m\u1ed7i-kh\xe1ch-h\xe0ng",level:5}],p={toc:h};function u(t){let{components:n,...a}=t;return(0,r.kt)("wrapper",(0,e.Z)({},p,a,{components:n,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"what-i-know-about-spark"},"What i know about Spark"),(0,r.kt)("h2",{id:"spark-l\xe0-g\xec"},"Spark l\xe0 g\xec?"),(0,r.kt)("p",null,"Spark l\xe0 m\u1ed9t framework m\xe3 ngu\u1ed3n m\u1edf t\xednh to\xe1n c\u1ee5m. T\u1ed1c \u0111\u1ed9 x\u1eed l\xfd c\u1ee7a c\u1ee7a Spark c\xf3 nhanh do vi\u1ec7c t\xednh to\xe1n \u0111\u01b0\u1ee3c th\u1ef1c hi\u1ec7n \u1edf b\u1ed9 nh\u1edb trong (in-memories) th\u1ef1c hi\u1ec7n ho\xe0n to\xe0n tr\xean RAM. (Spark ch\u1ea1y nhanh h\u01a1n 10 l\u1ea7n so v\u1edbi MapReduce \u1edf \u1ed5 c\u1ee9ng v\xe0 nhanh h\u01a1n 100 l\u1ea7n khi ch\u1ea1y tr\xean RAM)"),(0,r.kt)("p",null,"Spark cho ph\xe9p x\u1eed l\xfd d\u1eef li\u1ec7u thoe th\u1eddi gian th\u1ef1c, v\u1eeba nh\u1eadn d\u1eef li\u1ec7u t\u1eeb c\xe1c ngu\u1ed3n kh\xe1c nhau \u0111\u1ed3ng th\u1eddi th\u1ef1c hi\u1ec7n ngay vi\u1ec7c x\u1eed l\xfd tr\xean d\u1eef li\u1ec7u v\u1eeba nh\u1eadn \u0111\u01b0\u1ee3c (Spark Streaming)"),(0,r.kt)("h2",{id:"\u0111i\u1ec3m-n\u1ed5i-b\u1eadt"},"\u0110i\u1ec3m n\u1ed5i b\u1eadt"),(0,r.kt)("p",null,"X\u1eed l\xfd d\u1eef li\u1ec7u: Spark x\u1eed l\xfd d\u1eef li\u1ec7u theo batch v\xe0 realtime"),(0,r.kt)("p",null,"T\xednh t\u01b0\u01a1ng th\xedch: c\xf3 th\u1ec3 t\xedch h\u1ee3p v\u1edbi nhi\u1ec1u ngu\u1ed3n d\u1eef li\u1ec7u v\xe0 \u0111\u1ecbnh d\u1ea1ng t\u1ec7p \u0111\u01b0\u1ee3c h\u1ed7 tr\u1ee3 b\u1edfi c\u1ee5m Hadoop"),(0,r.kt)("p",null,"H\u1ed7 tr\u1ee3 ng\xf4n ng\u1eef l\u1eadp tr\xecnh: Java, Scala, Python, R"),(0,r.kt)("p",null,"Ph\xe2n t\xedch th\u1eddi gian th\u1ef1c:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Apache Spark c\xf3 th\u1ec3 x\u1eed l\xfd d\u1eef li\u1ec7u th\u1eddi gian th\u1ef1c t\u1ee9c l\xe0 d\u1eef li\u1ec7u \u0111\u1ebfn t\u1eeb c\xe1c lu\u1ed3ng s\u1ef1 ki\u1ec7n th\u1eddi gian th\u1ef1c v\u1edbi t\u1ed1c \u0111\u1ed9 h\xe0ng tri\u1ec7u s\u1ef1 ki\u1ec7n m\u1ed7i gi\xe2y. V\xed d\u1ee5: Data Twitter ch\u1eb3ng h\u1ea1n ho\u1eb7c lu\u1ee3t chia s\u1ebb, \u0111\u0103ng b\xe0i tr\xean Facebook. S\u1ee9c m\u1ea1nh Spark l\xe0 kh\u1ea3 n\u0103ng x\u1eed l\xfd lu\u1ed3ng tr\u1ef1c ti\u1ebfp hi\u1ec7u qu\u1ea3."),(0,r.kt)("li",{parentName:"ul"},"Apache Spark c\xf3 th\u1ec3 \u0111\u01b0\u1ee3c s\u1eed d\u1ee5ng \u0111\u1ec3 x\u1eed l\xfd ph\xe1t hi\u1ec7n gian l\u1eadn trong khi th\u1ef1c hi\u1ec7n c\xe1c giao d\u1ecbch ng\xe2n h\xe0ng. \u0110\xf3 l\xe0 b\u1edfi v\xec, t\u1ea5t c\u1ea3 c\xe1c kho\u1ea3n thanh to\xe1n tr\u1ef1c tuy\u1ebfn \u0111\u01b0\u1ee3c th\u1ef1c hi\u1ec7n trong th\u1eddi gian th\u1ef1c v\xe0 ch\xfang ta c\u1ea7n ng\u1eebng giao d\u1ecbch gian l\u1eadn trong khi qu\xe1 tr\xecnh thanh to\xe1n \u0111ang di\u1ec5n ra.")),(0,r.kt)("h2",{id:"pyspark"},"PySpark"),(0,r.kt)("p",null,"L\xe0 th\u01b0 vi\u1ec7n trong Python \u0111\u1ec3 t\u01b0\u01a1ng t\xe1c, x\u1eed d\u1ee5ng Spark."),(0,r.kt)("h3",{id:"create-a-sparksession"},"Create a SparkSession"),(0,r.kt)("p",null,"SparkSession l\xe0 \u0111i\u1ec3m truy c\u1eadp v\xe0o t\u1ea5t c\u1ea3 c\xe1c ch\u1ee9c n\u0103ng trong Spark v\xe0 \u0111\u01b0\u1ee3c y\xeau c\u1ea7u n\u1ebfu mu\u1ed1n s\u1eed d\u1ee5ng dataframe trong PySpark."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-python"},'spark = SparkSession.builder.appName("Datacamp Pyspark Tutorial").config("spark.memory.offHeap.enabled","true").config("spark.memory.offHeap.size","10g").getOrCreate()\n')),(0,r.kt)("p",null,"\u0110o\u1ea1n code tr\xean \u0111\xe3 t\u1ea1o m\u1ed9t Spark Session v\xe0 \u0111\u1eb7t t\xean cho application. Sau \u0111\xf3 data \u0111\u01b0\u1ee3c cache trong off-heap memory \u0111\u1ec3 tr\xe1nh l\u01b0u tr\u1eef tr\u1ef1c ti\u1ebfp tr\xean \u1ed5 c\u1ee9ng, v\xe0 dung l\u01b0\u1ee3ng memory \u0111\u01b0\u1ee3c ch\u1ec9 \u0111\u1ecbnh th\u1ee7 c\xf4ng."),(0,r.kt)("h3",{id:"create-the-dataframe"},"Create the DataFrame"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-python"},'df = spark.read.csv(\'datacamp_ecommerce.csv\',header=True,escape="\\"")\n')),(0,r.kt)("p",null,'param escape \u0111\u01b0\u1ee3c set v\u1edbi " \u0111\u1ec3 tr\xe1nh d\u1ea5u ph\u1ea9y trong string.'),(0,r.kt)("p",null," \u0110\u1ec3 xem 5 h\xe0ng \u0111\u1ea7u c\u1ee7a dataframe:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-python"},"df.show(5,0)\n")),(0,r.kt)("p",null,"0 nh\u1eb1m show to\xe0n b\u1ed9 c\xe1c c\u1ed9t tr\xe1nh \u1ea9n b\u1edbt th\xf4ng tin n\u1ebfu s\u1ed1 l\u01b0\u1ee3ng c\u1ed9t qu\xe1 nhi\u1ec1u."),(0,r.kt)("h3",{id:"exploratory-data-analysis"},"Exploratory Data Analysis"),(0,r.kt)("p",null,"\u0110\u1ebfm s\u1ed1 h\xe0ng trong DataFrame:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-python"},"df.count()  # Answer: 2,500\n")),(0,r.kt)("p",null,"\u0110\u1ebfm s\u1ed1 kh\xe1ch h\xe0ng duy nh\u1ea5t (unique) trong dataframe:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-python"},"df.select('CustomerID').distinct().count() # Answer: 95\n")),(0,r.kt)("p",null,"C\xe1c giao d\u1ecbch h\u1ea7u h\u1ebft \u0111\u1ebfn t\u1eeb qu\u1ed1c gia n\xe0o:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-python"},"from pyspark.sql.functions import *\nfrom pyspark.sql.types import *\n\ndf.groupBy('Country').agg(countDistinct('CustomerID').alias('country_count')).orderBy(desc('country_count')).show()\n")),(0,r.kt)("p",null,"b\u1ea3ng k\u1ebft qu\u1ea3 tr\xf4ng nh\u01b0 sau:"),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://images.datacamp.com/image/upload/v1661182577/descending_order_7_47be72ec10.png",alt:"descending order"})),(0,r.kt)("p",null,'\u0110\u1ec3 t\xecm th\u1eddi \u0111i\u1ec3m giao d\u1ecbch mua h\xe0ng g\u1ea7n nh\u1ea5t \u0111\u01b0\u1ee3c th\u1ef1c hi\u1ec7n c\u1ea7n chuy\u1ec3n c\u1ed9t "InvoiceDate" th\xe0nh \u0111\u1ecbnh d\u1ea1ng timestamp v\xe0 s\u1eed d\u1ee5ng max() function:'),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-python"},'spark.sql("set spark.sql.legacy.timeParserPolicy=LEGACY")\ndf = df.withColumn(\'date\',to_timestamp("InvoiceDate", \'yy/MM/dd HH:mm\'))\ndf.select(max("date")).show()\n')),(0,r.kt)("p",null,"K\u1ebft qu\u1ea3:"),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://images.datacamp.com/image/upload/v1661182577/max_8_58a68eaaef.png",alt:"max()"})),(0,r.kt)("h3",{id:"data-pre-processing"},"Data Pre-processing"),(0,r.kt)("p",null,"S\u1eed d\u1ee5ng c\xe1c bi\u1ebfn hi\u1ec7n c\xf3 \u0111\u1ec3 r\xfat ra ba \u0111\u1eb7c \u0111i\u1ec3m th\xf4ng tin m\u1edbi - recency, frequency v\xe0 monetary value (RFM)."),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Recency: M\u1ed7i kh\xe1ch h\xe0ng \u0111\xe3 mua h\xe0ng g\u1ea7n \u0111\xe2y nh\u01b0 th\u1ebf n\xe0o?"),(0,r.kt)("li",{parentName:"ol"},"Frequency: H\u1ecd c\xf3 th\u01b0\u1eddng xuy\xean mua th\u1ee9 g\xec \u0111\xf3 kh\xf4ng?"),(0,r.kt)("li",{parentName:"ol"},"Monetary value: Trung b\xecnh h\u1ecd chi bao nhi\xeau ti\u1ec1n khi mua h\xe0ng?")),(0,r.kt)("h4",{id:"g\xe1n-recency-score-cho-m\u1ed7i-kh\xe1ch-h\xe0ng"},"G\xe1n recency score cho m\u1ed7i kh\xe1ch h\xe0ng"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-python"},"df = df.withColumn(\"from_date\", lit(\"12/1/10 08:26\"))\ndf = df.withColumn('from_date',to_timestamp(\"from_date\", 'yy/MM/dd HH:mm'))\n\ndf2=df.withColumn('from_date',to_timestamp(col('from_date'))).withColumn('recency',col(\"date\").cast(\"long\") - col('from_date').cast(\"long\"))\n")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},'D\xf2ng \u0111\u1ea7u ti\xean t\u1ea1o m\u1ed9t c\u1ed9t m\u1edbi c\xf3 t\xean "from_date" trong PySpark DataFrame "df" v\xe0 \u0111\u1eb7t t\u1ea5t c\u1ea3 c\xe1c gi\xe1 tr\u1ecb trong c\u1ed9t n\xe0y th\xe0nh chu\u1ed7i "1/12/10 08:26". '),(0,r.kt)("li",{parentName:"ul"},'D\xf2ng th\u1ee9 hai chuy\u1ec3n \u0111\u1ed5i c\u1ed9t "from_date" t\u1eeb m\u1ed9t chu\u1ed7i sang \u0111\u1ecbnh d\u1ea1ng d\u1ea5u th\u1eddi gian b\u1eb1ng c\xe1ch s\u1eed d\u1ee5ng h\xe0m "to_timestamp". '),(0,r.kt)("li",{parentName:"ul"},'D\xf2ng th\u1ee9 ba t\u1ea1o m\u1ed9t DataFrame m\u1edbi c\xf3 t\xean l\xe0 "df2" b\u1eb1ng c\xe1ch \xe1p d\u1ee5ng hai ph\xe9p bi\u1ebfn \u0111\u1ed5i cho DataFrame g\u1ed1c "df".'),(0,r.kt)("li",{parentName:"ul"},'Ph\xe9p bi\u1ebfn \u0111\u1ed5i \u0111\u1ea7u ti\xean chuy\u1ec3n \u0111\u1ed5i c\u1ed9t "from_date" sang \u0111\u1ecbnh d\u1ea1ng d\u1ea5u th\u1eddi gian b\u1eb1ng c\xe1ch s\u1eed d\u1ee5ng h\xe0m "to_timestamp" kh\xf4ng c\xf3 \u0111\u1ed1i s\u1ed1.'),(0,r.kt)("li",{parentName:"ul"},'Ph\xe9p bi\u1ebfn \u0111\u1ed5i th\u1ee9 hai t\u1ea1o ra m\u1ed9t c\u1ed9t m\u1edbi g\u1ecdi l\xe0 "recency" b\u1eb1ng c\xe1ch tr\u1eeb Unix timestamp c\u1ee7a c\u1ed9t "from_date" v\u1edbi Unix timestamp c\u1ee7a c\u1ed9t "date". '),(0,r.kt)("li",{parentName:"ul"},'H\xe0m "col" \u0111\u01b0\u1ee3c d\xf9ng \u0111\u1ec3 tham chi\u1ebfu c\xe1c c\u1ed9t trong DataFrame. \u0110o\u1ea1n code n\xe0y \u0111\u01b0\u1ee3c s\u1eed d\u1ee5ng \u0111\u1ec3 chuy\u1ec3n \u0111\u1ed5i c\u1ed9t chu\u1ed7i sang \u0111\u1ecbnh d\u1ea1ng d\u1ea5u th\u1eddi gian v\xe0 t\xednh to\xe1n ch\xeanh l\u1ec7ch th\u1eddi gian gi\u1eefa hai c\u1ed9t trong PySpark DataFrame.')),(0,r.kt)("h5",{id:"ch\u1ecdn-giao-d\u1ecbch-mua-g\u1ea7n-\u0111\xe2y-nh\u1ea5t"},"Ch\u1ecdn giao d\u1ecbch mua g\u1ea7n \u0111\xe2y nh\u1ea5t"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-python"},"df2 = df2.join(df2.groupBy('CustomerID').agg(max('recency').alias('recency')),on='recency',how='leftsemi')\n")),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://images.datacamp.com/image/upload/v1661182578/recency_11_35aeec6956.png",alt:"l\u1ea7n g\u1ea7n \u0111\xe2y"})),(0,r.kt)("p",null,"Xem t\u1ea5t c\u1ea3 c\xe1c bi\u1ebfn b\u1eb1ng h\xe0ng printSchema. H\xe0m n\xe0y t\u01b0\u01a1ng \u0111\u01b0\u1eddng vs h\xe0m info trong Pandas:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-python"},"df2.printSchema()\n")),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://images.datacamp.com/image/upload/v1661182577/output_rendered12_2968b2d9c1.png",alt:"k\u1ebft qu\u1ea3 \u0111\u1ea7u ra"})),(0,r.kt)("h4",{id:"frequency"},"Frequency"),(0,r.kt)("p",null,"Ch\u1ec9 c\u1ea7n nh\xf3m theo t\u1eebng ID kh\xe1ch h\xe0ng v\xe0 \u0111\u1ebfm s\u1ed1 l\u01b0\u1ee3ng m\u1eb7t h\xe0ng h\u1ecd \u0111\xe3 mua:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-python"},"df_freq = df2.groupBy('CustomerID').agg(count('InvoiceDate').alias('frequency'))\n")),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://images.datacamp.com/image/upload/v1661182577/new_dataframe_13_6a2a778970.png",alt:"khung d\u1eef li\u1ec7u m\u1edbi"})),(0,r.kt)("p",null,"C\xf3 m\u1ed9t gi\xe1 tr\u1ecb t\u1ea7n s\u1ed1 \u0111\u01b0\u1ee3c th\xeam v\xe0o m\u1ed7i kh\xe1ch h\xe0ng trong khung d\u1eef li\u1ec7u. Khung d\u1eef li\u1ec7u m\u1edbi n\xe0y ch\u1ec9 c\xf3 hai c\u1ed9t => c\u1ea7n n\u1ed1i n\xf3 v\u1edbi c\u1ed9t tr\u01b0\u1edbc \u0111\xf3:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-python"},"df3 = df2.join(df_freq,on='CustomerID',how='inner')\n")),(0,r.kt)("h4",{id:"monetary-value"},"Monetary Value"),(0,r.kt)("h5",{id:"t\xecm-t\u1ed5ng-s\u1ed1-ti\u1ec1n-chi-ti\xeau-trong-m\u1ed7i-l\u1ea7n-mua-h\xe0ng"},"T\xecm t\u1ed5ng s\u1ed1 ti\u1ec1n chi ti\xeau trong m\u1ed7i l\u1ea7n mua h\xe0ng:"),(0,r.kt)("p",null,"M\u1ed7i ID kh\xe1ch h\xe0ng \u0111i k\xe8m v\u1edbi c\xe1c bi\u1ebfn \u0111\u01b0\u1ee3c g\u1ecdi l\xe0 \u201cQuantity\u201d v\xe0 \u201cUnitPrice\u201d cho m\u1ed9t l\u1ea7n mua h\xe0ng:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-python"},'m_val = df3.withColumn(\'TotalAmount\',col("Quantity") * col("UnitPrice"))\n')),(0,r.kt)("h5",{id:"t\xecm-t\u1ed5ng-s\u1ed1-ti\u1ec1n-chi-ti\xeau-c\u1ee7a-m\u1ed7i-kh\xe1ch-h\xe0ng"},"T\xecm t\u1ed5ng s\u1ed1 ti\u1ec1n chi ti\xeau c\u1ee7a m\u1ed7i kh\xe1ch h\xe0ng:"),(0,r.kt)("p",null,"\u0110\u1ec3 t\xecm t\u1ed5ng s\u1ed1 ti\u1ec1n chi ti\xeau c\u1ee7a t\u1eebng kh\xe1ch h\xe0ng, ch\xfang ta ch\u1ec9 c\u1ea7n nh\xf3m theo c\u1ed9t CustomerID v\xe0 t\xednh t\u1ed5ng s\u1ed1 ti\u1ec1n \u0111\xe3 chi ti\xeau:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-python"},"m_val = m_val.groupBy('CustomerID').agg(sum('TotalAmount').alias('monetary_value'))\n")),(0,r.kt)("p",null,"H\u1ee3p nh\u1ea5t dataframe n\xe0y v\u1edbi t\u1ea5t c\u1ea3 c\xe1c bi\u1ebfn kh\xe1c:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-python"},"finaldf = m_val.join(df3,on='CustomerID',how='inner')\n")),(0,r.kt)("p",null,"\u0110\u1ec3 ch\u1ec9 ch\u1ecdn c\xe1c c\u1ed9t \u0111\u01b0\u1ee3c y\xeau c\u1ea7u v\xe0 lo\u1ea1i b\u1ecf c\xe1c h\xe0ng tr\xf9ng l\u1eb7p kh\u1ecfi khung d\u1eef li\u1ec7u:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-python"},"finaldf = finaldf.select(['recency','frequency','monetary_value','CustomerID']).distinct()\n")))}u.isMDXComponent=!0}}]);